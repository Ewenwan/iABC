<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0">
  <title>爱上古诗 - 题库</title>
  <link rel="stylesheet" href="./res/layui/css/layui.css">
  <link rel="stylesheet" href="./res/static/css/index.css">
  <script src="./res/layui/layui.js"></script>
  <script src="./libs/axios/axios.min.js"></script>
  <script src="./js/dataSource.js"></script>
  <script src="./js/loader.js"></script>
</head>

<body>
  <!-- nav部分 -->
  <div class="nav">
    <div class="layui-container">
      <div class="nav-logo">
        <h1>爱上古诗 - 题库 <span id="index_view" class="nav-index"></span></h1>
      </div>
      <div class="nav-list">
        <ul class="layui-nav" lay-filter="">
          <li class="layui-nav-item"><a href="index.html">答题</a></li>
          <li class="layui-nav-item layui-this"><a href="inprogress.html">学习</a></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- main部分 -->
  <div class="main-about">
    <div class="layui-container">
      <div class="layui-row">
        <ul class="aboutab">
          <a class="layui-btn layui-btn-primary" href="https://share.weiyun.com/5IdIOOE" target="_blank">微云资料</a>
          <a class="layui-btn layui-btn-primary" onclick="getPrevious()">上一首</a>
          <a class="layui-btn layui-btn-primary layui-this" onclick="getNext()">下一首</a>
        </ul>
        <div class="tabJob">
          <div class="content" id="poem_view_container">
            <p id="poem_view"></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script id="poemView" type="text/html">
    <h3><a style="color: #0000ff" href ="https://baike.baidu.com/item/{{ d.title }}" target="_blank">{{ d.title }}</a></h3>
    <h5>{{ d.author }}</h5>
    <ul>
    {{#  layui.each(d.contentList, function(index, item){ }}
      <li>
        <span>{{ item }}</span>
      </li>
    {{#  }); }}
    {{#  if(d.contentList.length === 0){ }}
      无数据
    {{#  } }} 
    </ul>
  </script>

  <!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
  <script>
    layui.config({
      base: './res/static/js/'
    }).use('firm'); 
  </script>

  <script>
    document.addEventListener("keydown", keydown);

    function keydown(event) {
      //表示键盘监听所触发的事件，同时传递参数event
      switch (event.keyCode) {
        case 37: // ArrowLeft
          getPrevious();
          break;
        case 39: // ArrowRight
          getNext();
          break;
        default:
          break;
      }
    }

    function viewRender(viewId, templateId, data) {
      layui.use('laytpl', function (laytpl) {

        var view = document.getElementById(viewId);
        var getTpl = document.getElementById(templateId).innerHTML;
        var controller = function (view) {
          try {
            var html = laytpl(getTpl).render(data);
            view.innerHTML = html;
          } catch (e) {
            view.innerHTML = '<span style="color: #c00;">' + e.toString() + '</span>';
          }
        };

        controller(view);
      });
    }

    function render(poem) {
      poem.contentList = poem.content.split("\n");

      viewRender('poem_view', "poemView", poem);
      // index_view
      document.getElementById("index_view").innerHTML = `${index} / ${NUM}`;
    }

    // init
    let poemArray = getInprogress();
    let index = 0;
    let NUM = poemArray.length;

    function getNext() {
      // 重新计数
      if (index === poemArray.length) {
        index = 0;
      }
      const jsonObj = poemArray[index++];
      render(jsonObj);
    }

    function getPrevious() {
      // 重新计数
      if (index === 1) {
        index = poemArray.length + 1;
      }

      index = index - 2;
      const jsonObj = poemArray[index];

      index = index + 1; // for display
      render(jsonObj);
    }

    getNext();

  </script>
</body>

</html>